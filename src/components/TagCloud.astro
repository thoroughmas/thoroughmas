---
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';
import { slugifyTag } from '../utils/formatTags';

type BlogPost = CollectionEntry<'blog'>;

const allPosts: BlogPost[] = await getCollection('blog');
const listedPosts = allPosts.filter((post) => post.data.listed !== false);

// Extract and count tags
const tagCounts = new Map<string, number>();
listedPosts.forEach((post) => {
	post.data.tags?.forEach((tag) => {
		tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
	});
});

// Sort by popularity and take top 6 for minimal display
const popularTags = Array.from(tagCounts.entries())
	.sort(([, a], [, b]) => b - a)
	.slice(0, 6)
	.map(([tag, count]) => ({ tag, count }));
---

{
	popularTags.length > 0 && (
		<div class='text-right'>
			<div class='text-[10px] text-zinc-400/70 dark:text-zinc-500/60 mb-1.5 uppercase tracking-wider'>Popular tags</div>
			<div class='flex flex-wrap gap-1.5 justify-end max-w-xs'>
				{popularTags.map(({ tag, count }) => (
					<a
						href={`/tags/${slugifyTag(tag)}/`}
						class='inline-block px-2 py-0.5 text-[11px] rounded-full
						border border-zinc-300 dark:border-zinc-600
						text-zinc-700 dark:text-zinc-300
						hover:text-zinc-900 dark:hover:text-zinc-200
						hover:border-zinc-400 dark:hover:border-zinc-500
						hover:bg-zinc-50 dark:hover:bg-zinc-800/50
						transition-all duration-200 no-underline'
						title={`${count} post${count > 1 ? 's' : ''} tagged with ${tag}`}>
						{tag}
					</a>
				))}
			</div>
		</div>
	)
}
