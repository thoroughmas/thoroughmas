---
import { SITE_TITLE, SITE_TAGLINE, SITE_DESCRIPTION } from '../consts';
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import Tommy from '@src/assets/img/tmcamera_2.jpg';
import Prose from '../components/Prose.astro';
import { projects } from './projects/projects';
import ProjectList from '../components/ProjectList.astro'
import PostItem from '../components/PostItem.astro'; 

type BlogPost = CollectionEntry<'blog'>; 
const top6Projects = projects.slice(0, 6);
const posts = (await getCollection('blog'))
  .filter((post): post is BlogPost => {
    const isListed = post.data.listed !== false;
    console.log(`Post ${post.slug} - listed: ${isListed}`);
    return isListed;
  })
  .filter(post => {
    const isFeatured = post.data.featured === true;
    console.log(`Post ${post.slug} - featured: ${isFeatured}`);
    return isFeatured;
  })
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

console.log('Featured posts:', posts.map(p => p.slug));
---

<BaseLayout title={SITE_TITLE + ' - ' + SITE_TAGLINE} description={SITE_DESCRIPTION}>
  <div class='container'>
    <div class='w-full md:flex md:items-center gap-16 mb-10'>
      <div class="flex flex-col md:flex-1">
        <div class="text-pretty leading-9">
          <h1 class="text-5xl font-bold mb-4 custom-name-title">Thomas Midena</h1>
          <Prose>
            <div class="text-lg">
              <p>I'm big into storytelling, technology, and technology-driven storytelling.</p>
              <p>This website is a portal to all my online activities.</p>
            </div>
          </Prose>
        </div>
        <div class="social-icons mt-4 mb-8 md:mb-0">
          <a href="https://bsky.app/profile/thomid.me" target="_blank" rel="noopener noreferrer">
            <img src="/icons/bluesky_1.svg" alt="Bluesky" title="Bluesky"/>
          </a>
          <a href="https://mastodon.au/@thoroughmas" target="_blank" rel="me noopener noreferrer">
            <img src="/icons/mastodon_1.svg" alt="Mastodon" title="Mastodon"/>
          </a>
          <a href="https://pixelfed.au/thoroughmas" target="_blank" rel="noopener noreferrer">
            <img src="/icons/pixelfed_1.svg" alt="Pixelfed" title="Pixelfed"/>
          </a>
          <a href="https://instagram.com/thoroughmas" target="_blank" rel="noopener noreferrer">
            <img src="/icons/instagram_1.svg" alt="Instagram" title="Instagram"/>
          </a>
          <a href="https://youtube.com/@thoroughmas" target="_blank" rel="noopener noreferrer">
            <img src="/icons/youtube_1.svg" alt="YouTube" title="YouTube"/>
          </a>
          <a href="https://www.twitch.tv/thoroughmas" target="_blank" rel="noopener noreferrer">
            <img src="/icons/twitch_1.svg" alt="Twitch" title="Twitch"/>
          </a>
          <a href="https://thomid.me/rss.xml" target="_blank" rel="noopener noreferrer" style="transform: scale(1.3);">
            <img src="/icons/rss_1.svg" alt="RSS" title="RSS"/>
          </a>
        </div>
      </div>
      <div class="md:flex-shrink-0">
        <Image
          src={Tommy}
          alt="Thomas Midena"
          width={800}
          quality={100}
          format="webp"
          loading="eager"
          class="rounded-3xl rotate-3 mx-auto md:mx-0 w-[300px]"
        />
      </div>
    </div>
		<main>
      <div class='mt-6 mb-12'>
        <div class="flex justify-between gap-2 border-b mb-1 dark:border-b-zinc-700">
          <h2 class="text-lg font-bold mb-3">Recent Blog Posts</h2>
          <a href="/posts/" class="inline-block py-2 underline dark:prose-invert">All posts &raquo;</a>
        </div>
        <div>
          {
            posts.map((post: BlogPost) => (
              <PostItem post={post} />
            ))
          }      
        </div>
        <div class="text-right">
        </div>
      </div>
      <div>
        <div class="flex justify-between gap-2 mb-1">
          <h2 class="text-lg font-bold mb-3">Active Projects</h2>
          <a href="/projects/" class="inline-block py-2 underline dark:prose-invert">All projects &raquo;</a>
        </div>
        <ProjectList projects={top6Projects}/>
      </div>
		</main>
	</div>
</BaseLayout>

<style>
  .social-icons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
  }
  
  @media (min-width: 768px) {
    .social-icons {
      justify-content: flex-start;
    }
  }
  
  .social-icons img {
    width: 28px;
    height: 28px;
    transition: transform 0.3s ease;
  }
  
  .social-icons a:hover img {
    transform: scale(1.1);
  }
  </style>
